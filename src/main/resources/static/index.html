<!DOCTYPE html>
<html>
<head>
    <title>Private Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Spring WebSocket Chat</h1>

<input type="text" id="name" placeholder="Your name">
<button onclick="connect()">Connect</button>

<p id="status" style="color: red; font-weight: bold;">Not Connected</p>

<!-- Private chat -->
<input type="text" id="recipient" placeholder="Recipient username">
<input type="text" id="privateMessage" placeholder="Type private message">
<button onclick="sendPrivateMessage()">Send Private</button>
<br><br>


<h3>Private Messages:</h3>
<ul id="privateMessages"></ul>

<script>
    let stompClient = null;
    let username = null;

    function connect() {
        const socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);
        username = document.getElementById("name").value || "Anonymous";


        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);

            document.getElementById("status").textContent = "âœ… Connected as " + username;
            document.getElementById("status").style.color = "green";


            // Subscribe to personal private queue
            stompClient.subscribe('/queue/private.' + username, function(msg) {
                const message = JSON.parse(msg.body);
                showMessage("privateMessages", message.sender + ": " + message.content);
            });
        });
    }

    function sendPrivateMessage() {
        const recipient = document.getElementById("recipient").value;
        const content = document.getElementById("privateMessage").value;
        stompClient.send("/app/chat.sendPrivate", {}, JSON.stringify({
            sender: username,
            recipient: recipient,
            content: content
        }));
        document.getElementById("privateMessage").value = "";
    }

    function showMessage(listId, message) {
        const messages = document.getElementById(listId);
        const li = document.createElement("li");
        li.appendChild(document.createTextNode(message));
        messages.appendChild(li);
    }
</script>
</body>
</html>
